#SERVER A

#connect to tpm simulator on port 2321
export TPM2TOOLS_TCTI=mssim:host=localhost,port=2321
tpm2_startup -c

#CREATE SYMMETRIC KEY ON SERVER A

#flush context
tpm2_flushcontext -t

#generate symmetric key through random hex number
tpm2_getrandom -o aes.ctx --hex 16

#encrypt secret.txt with symmetric key
tpm2_encryptdecrypt -c aes.ctx -o symsecret.enc secret.txt

#sign with symmetric key
tpm2_sign -c aes.ctx -g sha256 -p password -o symsig.rssa secret.txt

#encrypt symmetric key with rsa key generated earlier
tpm2_rsaencrypt -c key.ctx -o aes.enc aes.ctx
